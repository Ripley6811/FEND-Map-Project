/*! frontend-nanodegree-map-project 2015-01-14 */
function initialize(){"use strict";var a=document.createElement("div");a.id="map-canvas",a.style.backgroundColor="gold",a.style.width="100%",a.style.minHeight="100%",document.querySelector("body").appendChild(a),app.addMapToDiv(a);var b=document.createElement("div");b.id="legend",b.style.backgroundColor="white",b.style.padding="10px",b.style.margin="10px",b.innerHTML="Search",document.querySelector("body").appendChild(b),app.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(b),app.addFeaturesToMap(),app.getPhotoList(app.addPhotoMarkers);var c=document.createElement("div");c.innerHTML='<input data-bind="value: searchPhrase">',b.appendChild(c);var d=document.createElement("div");d.style.maxHeight="300px",d.style.overflow="auto",d.innerHTML=["<table>",'<tbody data-bind="foreach: features">','<tr data-bind="click: $root.panTo">','<td><img alt="feature icon" data-bind="attr: {src: icon}" /></td>','<td data-bind="text: title"></td>',"</tr>","</tbody>","</table>"].join(""),b.appendChild(d),ko.applyBindings(app.viewModel)}var app=app||{};app.center=new google.maps.LatLng(22.735281,120.353368),google.maps.event.addDomListener(window,"load",initialize),app.addMapToDiv=function(a){var b={center:app.center,zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP};app.map=new google.maps.Map(a,b)},app.addFeaturesToMap=function(){for(var a=0;a<app.features.length;a++)app.addMapMarker(app.features[a]),app.viewModel.features.push(app.features[a])},app.addPhotoMarkers=function(a){for(var b=0;b<a.length;b++)app.getPhotoGeo(a[b],function(a){a.icon="icons/photo.png",app.addMapMarker(a),app.viewModel.features.push(a)})},app.addMapMarker=function(a){{var b=a.position;new google.maps.Marker({position:new google.maps.LatLng(b.lat,b.lon),map:app.map,title:a.title,icon:a.icon,animation:google.maps.Animation.DROP})}},app.viewModel=new function(){this.searchPhrase=ko.observable("random words"),this.features=ko.observableArray(),this.panTo=function(a){app.map.panTo(new google.maps.LatLng(a.position.lat,a.position.lon))}};var app=app||{};app.features=[{title:"Archery range",position:{lat:22.734471,lon:120.333068},icon:"icons/archery.png"},{title:"Jogging in the park",position:{lat:22.731795,lon:120.316772},icon:"icons/jogging.png"},{title:"Mountain hiking",position:{lat:22.725501,lon:120.370888},icon:"icons/hiking.png"},{title:"Swimming pool",position:{lat:22.733508,lon:120.331715},icon:"icons/swimming.png"},{title:"Bicycle maintenance",position:{lat:22.731711,lon:120.32952},icon:"icons/cycling.png"}];var app=app||{};app.getPhotoList=function(a){"use strict";var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4===b.readyState&&200===b.status){var c=JSON.parse(b.response);"ok"===c.stat?a(c.photos.photo):console.log("ERROR in app.getPhotoList: "+c.message)}};var c=["method=flickr.people.getPublicPhotos","api_key=e224e71bda1508efe89de86b3b30ed9f","user_id=91602303%40N03","per_page=500","format=json","nojsoncallback=1"];b.open("GET","https://api.flickr.com/services/rest/?"+c.join("&"),!0),b.send()},app.getPhotoGeo=function(a,b){"use strict";var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){var d=JSON.parse(c.response);"ok"===d.stat&&(a.position={lat:d.photo.location.latitude,lon:d.photo.location.longitude},b(a))}};var d=["method=flickr.photos.geo.getLocation","api_key=e224e71bda1508efe89de86b3b30ed9f","photo_id="+a.id,"format=json","nojsoncallback=1"];c.open("GET","https://api.flickr.com/services/rest/?"+d.join("&"),!0),c.send()};