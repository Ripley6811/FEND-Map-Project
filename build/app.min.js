/*! frontend-nanodegree-map-project 2015-01-15 */
function initialize(){"use strict";var a=document.createElement("div");a.id="map-canvas",a.style.backgroundColor="gold",a.style.width="100%",a.style.minHeight="100%",document.querySelector("body").appendChild(a),app.addMapToDiv(a);var b=document.createElement("div");b.id="legend",b.style.backgroundColor="white",b.style.padding="10px",b.style.margin="10px",b.innerHTML="Search",document.querySelector("body").appendChild(b),app.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(b),app.addFeaturesToMap(),app.getPhotoList(app.addPhotoMarkers);var c=document.createElement("div");c.innerHTML='<input data-bind="value: searchPhrase">',b.appendChild(c);var d=document.createElement("div");d.style.padding="10px",d.innerHTML=["<table>","<tbody>","<tr>",'<td><img src="icons/orange_blank.png" width="20"></td>',"<td>My Activities</td>",'<td width="25"></td>','<td><img src="icons/purple_blank.png" width="20"></td>',"<td>My Photos</td>","</tr>","</tbody>","</table>"].join(""),b.appendChild(d);var e=document.createElement("div");e.style.maxHeight="300px",e.style.overflow="auto",e.innerHTML=["<table>",'<tbody data-bind="foreach: features">','<tr data-bind="click: $root.panTo">','<td><img alt="feature icon" data-bind="attr: {src: icon}" /></td>','<td data-bind="text: title"></td>',"</tr>","</tbody>","</table>"].join(""),b.appendChild(e),ko.applyBindings(app.viewModel)}var app=app||{};app.center=new google.maps.LatLng(22.735281,120.353368),google.maps.event.addDomListener(window,"load",initialize),app.viewModel=new function(){this.searchPhrase=ko.observable("random words"),this.runSearch=ko.computed(function(){console.log(this.searchPhrase())},this),this.features=ko.observableArray(),this.panTo=function(a){app.map.panTo(a.marker.getPosition()),app.showInfoWindow(a)}},app.showInfoWindow=function(a){var b="";if(a.farm)b='<img src="https://farm{farm-id}.staticflickr.com/{server-id}/{id}_{secret}_[mstzb].jpg" alt="{title}"><br>',b=b.replace("{farm-id}",a.farm),b=b.replace("{server-id}",a.server),b=b.replace("{id}",a.id),b=b.replace("{secret}",a.secret),b=b.replace("[mstzb]","n"),b=b.replace("{title}",a.title.replace(/"/g,"&quot;"));else{b='<img src="http://maps.googleapis.com/maps/api/streetview?size={size}&location={location}" alt="{title}"><br>',b=b.replace("{size}","320x200");var c=a.position;b=b.replace("{location}",[c.lat,c.lon].join(",")),b=b.replace("{title}",a.title.replace(/"/g,"&quot;"))}app.infoWindow&&app.infoWindow.close(),app.infoWindow=new google.maps.InfoWindow({content:'<div style="text-align: center">'+b+a.title.replace(/"/g,"&quot;")+"</div>"}),app.infoWindow.open(app.map,a.marker)},app.addMapToDiv=function(a){var b={center:app.center,zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP};app.map=new google.maps.Map(a,b)},app.addFeaturesToMap=function(){for(var a=0;a<app.features.length;a++)app.addMapMarker(app.features[a])},app.addPhotoMarkers=function(a){for(var b=0;b<a.length;b++)app.getPhotoGeo(a[b],function(a){a.icon="icons/photo.png",app.addMapMarker(a)})},app.addMapMarker=function(a){var b=a.position;a.marker=new google.maps.Marker({position:new google.maps.LatLng(b.lat,b.lon),map:app.map,title:a.title,icon:a.icon,animation:google.maps.Animation.DROP}),google.maps.event.addListener(a.marker,"click",function(){app.showInfoWindow(a)}),app.viewModel.features.push(a)};var app=app||{};app.features=[{title:"Archery range",position:{lat:22.734782,lon:120.332857},icon:"icons/archery.png"},{title:"Jogging in the park",position:{lat:22.731795,lon:120.316772},icon:"icons/jogging.png"},{title:"Mountain hiking",position:{lat:22.725501,lon:120.370888},icon:"icons/hiking.png"},{title:"Swimming pool",position:{lat:22.733508,lon:120.331715},icon:"icons/swimming.png"},{title:"Bicycle maintenance",position:{lat:22.731606,lon:120.329661},icon:"icons/cycling.png"}];var app=app||{};app.getPhotoList=function(a){"use strict";var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4===b.readyState&&200===b.status){var c=JSON.parse(b.response);"ok"===c.stat?a(c.photos.photo):console.log("ERROR in app.getPhotoList: "+c.message)}};var c=["method=flickr.people.getPublicPhotos","api_key=e224e71bda1508efe89de86b3b30ed9f","user_id=91602303%40N03","per_page=500","format=json","nojsoncallback=1"];b.open("GET","https://api.flickr.com/services/rest/?"+c.join("&"),!0),b.send()},app.getPhotoGeo=function(a,b){"use strict";var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){var d=JSON.parse(c.response);"ok"===d.stat&&(a.position={lat:d.photo.location.latitude,lon:d.photo.location.longitude},b(a))}};var d=["method=flickr.photos.geo.getLocation","api_key=e224e71bda1508efe89de86b3b30ed9f","photo_id="+a.id,"format=json","nojsoncallback=1"];c.open("GET","https://api.flickr.com/services/rest/?"+d.join("&"),!0),c.send()};