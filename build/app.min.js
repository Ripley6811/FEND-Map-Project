/*! frontend-nanodegree-map-project 2015-02-21 */
function initialize(){"use strict";app.map=app.getGoogleMap(document.getElementById("map-canvas")),app.addFeaturesToMap(),app.getPhotoList(app.addPhotoMarkers),ko.applyBindings(app.viewModel)}var app=app||{};app.center=new google.maps.LatLng(22.735281,120.353368),google.maps.event.addDomListener(window,"load",initialize),app.viewModel=new function(){var a=this;a.searchPhrase=ko.observable(""),a.sidebarVisible=ko.observable(!1),a.sidebarSetVisible=function(){a.sidebarVisible(!0)},a.sidebarSetInvisible=function(){a.sidebarVisible(!1)},a.toggleSidebar=function(){a.sidebarVisible(!a.sidebarVisible())},ko.computed(function(){var b=document.getElementById("swipe-bar");b.style.right=a.sidebarVisible()?"220px":"0px"}),a.winWidth=ko.observable(window.innerWidth),a.winHeight=ko.observable(window.innerHeight),a.mobileView=ko.computed(function(){return a.winWidth()<992}),ko.computed(function(){document.getElementById("feature-list").style.height=[a.winHeight()-150,"px"].join("")}),a.searchPhrase.subscribe(function(a){if(""!=a){var b=app.map.getCenter();app.getFoursquareResponse(b.k,b.D,a,app.processFoursquareResponse)}}),a.features=ko.observableArray(),a.foursquareCount=ko.observable(0),a.panTo=function(b){document.getElementById("map-canvas").focus(),a.mobileView()&&a.sidebarVisible(!1),app.map.panTo(b.marker.getPosition()),app.map.panBy(0,-120),app.showInfoWindow(b)}},window.onresize=function(){app.viewModel.winWidth(window.innerWidth),app.viewModel.winHeight(window.innerHeight),app.width=window.innerWidth,app.height=window.innerHeight},app.width=window.innerWidth,app.height=window.innerHeight,app.processFoursquareResponse=function(a){for(var b=app.viewModel.features().length-1;b>=0;b-=1)"icons/foursquare.png"===app.viewModel.features()[b].marker.icon&&(app.viewModel.features()[b].marker.setMap(null),app.viewModel.features.splice(b,1));var c=a.response.groups[0].items;if(app.viewModel.foursquareCount(c.length),0==c.length)alert('No results found for "'+app.viewModel.searchPhrase()+'"');else for(var b=0;b<c.length;b+=1){var d={title:c[b].venue.name,icon:"icons/foursquare.png",position:{lat:c[b].venue.location.lat,lon:c[b].venue.location.lng}};app.addMapMarker(d,0)}},app.showInfoWindow=function(a){var b="";if(a.farm)b=app.toFlickrDiv(a);else{b='<img src="http://maps.googleapis.com/maps/api/streetview?size={size}&location={location}" alt="{title}"><br>',b=b.replace("{size}",app.width<600?"150x120":"320x200");var c=a.position;b=b.replace("{location}",[c.lat,c.lon].join(",")),b=b.replace("{title}",a.title.replace(/"/g,"&quot;"))}app.infoWindow&&app.infoWindow.close(),app.infoWindow=new google.maps.InfoWindow({content:['<div style="text-align: center">',b,"<br>",a.title.replace(/"/g,"&quot;"),"</div>"].join("")}),app.infoWindow.open(app.map,a.marker),null!=app.currentMarker&&app.currentMarker.setAnimation(null),a.marker.setAnimation(google.maps.Animation.BOUNCE),app.currentMarker=a.marker},app.getGoogleMap=function(a){var b={center:app.center,zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP};return new google.maps.Map(a,b)},app.addFeaturesToMap=function(){for(var a=0;a<app.features.length;a++)app.addMapMarker(app.features[a])},app.addPhotoMarkers=function(a){for(var b=0;b<a.length;b++)app.getPhotoGeo(a[b],function(a){a.icon="icons/photo.png",app.addMapMarker(a)})},app.currentMarker=null,app.addMapMarker=function(a,b){var c=a.position;a.marker=new google.maps.Marker({position:new google.maps.LatLng(c.lat,c.lon),map:app.map,title:a.title,icon:a.icon,animation:google.maps.Animation.DROP}),google.maps.event.addListener(a.marker,"click",function(){app.showInfoWindow(a)}),void 0!==b&&b/1==b?app.viewModel.features.splice(0,0,a):app.viewModel.features.push(a)};var app=app||{};app.features=[{title:"Archery range",position:{lat:22.734782,lon:120.332857},icon:"icons/archery.png"},{title:"Jogging in the park",position:{lat:22.731795,lon:120.316772},icon:"icons/jogging.png"},{title:"Mountain hiking",position:{lat:22.725501,lon:120.370888},icon:"icons/hiking.png"},{title:"Swimming pool",position:{lat:22.733508,lon:120.331715},icon:"icons/swimming.png"},{title:"Bicycle maintenance",position:{lat:22.731606,lon:120.329661},icon:"icons/cycling.png"}];var app=app||{};app.flickr_user_id="91602303%40N03",app.getPhotoList=function(a){"use strict";var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4===b.readyState&&200===b.status){var c=JSON.parse(b.response);"ok"===c.stat?a(c.photos.photo):console.log("ERROR in app.getPhotoList: "+c.message)}};var c=["method=flickr.people.getPublicPhotos","api_key=e224e71bda1508efe89de86b3b30ed9f","user_id="+app.flickr_user_id,"per_page=500","format=json","nojsoncallback=1"];b.open("GET","https://api.flickr.com/services/rest/?"+c.join("&"),!0),b.send()},app.getPhotoGeo=function(a,b){"use strict";var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){var d=JSON.parse(c.response);"ok"===d.stat&&(a.position={lat:d.photo.location.latitude,lon:d.photo.location.longitude},b(a))}};var d=["method=flickr.photos.geo.getLocation","api_key=e224e71bda1508efe89de86b3b30ed9f","photo_id="+a.id,"format=json","nojsoncallback=1"];c.open("GET","https://api.flickr.com/services/rest/?"+d.join("&"),!0),c.send()},app.toFlickrDiv=function(a){return imgDiv=['<a href="https://www.flickr.com/photos/{user-id}/{id}">','<img src="https://farm{farm-id}.staticflickr.com/{server-id}/{id}_{secret}_[mstzb].jpg" alt="{title}">',"</a>"].join(""),imgDiv=imgDiv.replace("{user-id}",app.flickr_user_id),imgDiv=imgDiv.replace("{farm-id}",a.farm),imgDiv=imgDiv.replace("{server-id}",a.server),imgDiv=imgDiv.replace("{id}",a.id),imgDiv=imgDiv.replace("{id}",a.id),imgDiv=imgDiv.replace("{secret}",a.secret),imgDiv=imgDiv.replace("[mstzb]",app.width<600?"q":"n"),imgDiv=imgDiv.replace("{title}",a.title.replace(/"/g,"&quot;")),imgDiv};var app=app||{};app.getFoursquareResponse=function(a,b,c,d){"use strict";var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var a=JSON.parse(e.response);200===a.meta.code?d(a):console.log("ERROR in app.getFoursquareResponse: "+a.message)}};var f=["https://api.foursquare.com/v2/venues/explore","?client_id=P0APIITDRLPFDGL1ARPRCWMVV055QQOACFUWVNZDWLGLDSZB","&client_secret=SHHYNZZT1QTSR45SQQ1MRQV4FZKHKNYLGJ1LRZVT0HB5RFJU","&v=20130815","&ll="+a+","+b,"&radius=8000","&query="+c].join("");e.open("GET",f,!0),e.send()};